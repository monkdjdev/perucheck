---
import Layout from '../layouts/Layout.astro';
import TipoCambioWidget from '../components/TipoCambioWidget';
import ComparadorBancos from '../components/ComparadorBancos';
import HistorialTC from '../components/HistorialTC';
import { getTipoCambio } from '../utils/tipoCambioService';

// Obtener tipo de cambio real desde el servidor
let tipoCambio;
try {
  tipoCambio = await getTipoCambio();
} catch {
  tipoCambio = { compra: 0, venta: 0, fuente: 'No disponible', fecha: '' };
}

const initialTcData = {
  compra: tipoCambio.compra,
  venta: tipoCambio.venta,
  fuente: tipoCambio.fuente,
  fecha: tipoCambio.fecha,
};
---

<Layout
  title="Tipo de Cambio Hoy"
  description="Tipo de cambio del dolar hoy en Peru. Compara tasas de SUNAT, BCP, Interbank, BBVA, Rextie y Kambista. Convertidor de dolares a soles en tiempo real."
  canonical="/tipo-de-cambio"
>
  <div class="mb-6">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 rounded-xl bg-indigo-50 flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-indigo-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="1" x2="12" y2="23" />
          <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
        </svg>
      </div>
      <div>
        <h1 class="text-2xl font-bold">Tipo de Cambio Hoy en Peru</h1>
        <p class="text-[var(--color-text-muted)] text-sm mt-0.5">
          Consulta el tipo de cambio del dolar actualizado y compara entre bancos y casas de cambio digitales.
        </p>
      </div>
    </div>
  </div>

  <div class="space-y-6">
    <TipoCambioWidget client:load initialData={initialTcData} />
    <ComparadorBancos client:load initialCompra={tipoCambio.compra} initialVenta={tipoCambio.venta} />
    <HistorialTC client:load />

    <!-- Contenido SEO -->
    <div class="bg-white rounded-2xl border border-[var(--color-border)] p-6 hover:shadow-sm transition-shadow">
      <div class="flex items-center gap-2 mb-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-indigo-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10" />
          <line x1="12" y1="16" x2="12" y2="12" />
          <line x1="12" y1="8" x2="12.01" y2="8" />
        </svg>
        <h2 class="text-lg font-bold">Sobre el tipo de cambio en Peru</h2>
      </div>
      <div class="text-sm text-[var(--color-text-muted)] space-y-3">
        <p>
          El tipo de cambio oficial en Peru es publicado diariamente por la SUNAT (Superintendencia Nacional
          de Aduanas y de Administracion Tributaria). Este tipo de cambio se utiliza como referencia para
          operaciones tributarias y aduaneras.
        </p>
        <p>
          Los bancos comerciales como BCP, Interbank, BBVA y Scotiabank manejan sus propias tasas que
          generalmente tienen un spread mayor. Las casas de cambio digitales como Rextie, Kambista y TKambio
          suelen ofrecer mejores tasas al operar con menores costos operativos.
        </p>
        <h3 class="font-semibold text-[var(--color-text)] !mt-4">Consejos para cambiar dolares</h3>
        <ul class="list-disc list-inside space-y-1">
          <li><strong>Si vendes dolares:</strong> busca la tasa de compra mas alta.</li>
          <li><strong>Si compras dolares:</strong> busca la tasa de venta mas baja.</li>
          <li>Las casas de cambio digitales suelen ofrecer mejores tasas que los bancos.</li>
          <li>Compara siempre antes de hacer una operacion grande.</li>
        </ul>
      </div>
    </div>
  </div>
</Layout>
